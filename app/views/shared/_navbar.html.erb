<% if user_signed_in? %>
<nav class="bg-white border-b border-gray-200">
  <div class="container mx-auto px-4">
    <div class="flex justify-between h-16">
      <%# tab bar 或 返回鈕+使用者email %>
      <div class="flex items-center">
        <% if controller.controller_path == 'admin/tasks' %>
          <%# admin/tasks/index 頁面：顯示返回鈕 + 被查看使用者的 email %>
          <div class="flex items-center gap-3">
            <%= link_to admin_users_path, 
                class: "flex items-center justify-center w-8 h-8 rounded-full text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition duration-150",
                title: t('admin.tasks.index.back') do %>
              <%= inline_svg_icon("icons/arrow-left.svg", class: "w-5 h-5") %>
            <% end %>
            <span class="text-gray-700 font-medium"><%= @user&.email %></span>
          </div>
        <% else %>
          <%# 其他頁面：顯示 Tab 導航 %>
          <% if current_user.admin? %>
            <nav class="flex space-x-1">
              <%= link_to admin_users_path, 
                  class: "px-4 py-2 rounded-full text-sm font-medium transition duration-150 #{current_page?(admin_users_path) ? 'bg-indigo-100 text-indigo-700' : 'text-gray-500 hover:text-gray-700 hover:bg-gray-100'}" do %>
                <%= t('navbar.admin_users') %>
              <% end %>
              <%= link_to tasks_path,
                  class: "px-4 py-2 rounded-full text-sm font-medium transition duration-150 #{current_page?(tasks_path) ? 'bg-indigo-100 text-indigo-700' : 'text-gray-500 hover:text-gray-700 hover:bg-gray-100'}" do %>
                <%= t('navbar.personal_tasks') %>
              <% end %>
            </nav>
          <% end %>
        <% end %>
      </div>

      <%# 使用者資訊與登出 %>
      <div class="flex items-center">
        <details class="relative group" id="user-menu-dropdown">
          <%# user icon & name %>
          <summary 
            data-testid="user-menu-btn" 
            class="flex items-center gap-3 cursor-pointer list-none focus:outline-none"
          >
            <span class="text-gray-700 font-medium hidden sm:block max-w-[150px] truncate">                
              <%= current_user.name %>
            </span>
            <%# User Avatar %>
            <div class="w-10 h-10 rounded-full bg-gray-200 overflow-hidden">
              <%= inline_svg_icon("icons/user-avatar.svg", class: "w-full h-full") %>
            </div>
            <%# 小箭頭 %>
            <%= inline_svg_icon("icons/chevron-down.svg", class: "w-4 h-4 text-gray-500 transition-transform duration-200 group-open:rotate-180") %>
          </summary>

          <%# 下拉內容 %>
          <div class="absolute right-0 mt-2 w-auto min-w-[120px] bg-white rounded-md shadow-lg py-1 ring-1 ring-black ring-opacity-5 z-50 whitespace-nowrap">
            <%= button_to logout_path, method: :delete, data: { testid: "logout-btn" }, class: "w-full text-left block px-4 py-2 text-sm text-red-600 hover:bg-gray-100 flex items-center gap-2" do %>
               <%= inline_svg_icon("icons/logout.svg", class: "w-4 h-4") %>
               <%= t('navbar.logout') %>
            <% end %>
          </div>
          
          <%# 點擊外部關閉選單 %>
          <div class="fixed inset-0 z-40 hidden group-open:block" onclick="this.parentNode.removeAttribute('open')"></div>
        </details>
      </div>
    </div>
  </div>
</nav>
<% end %>